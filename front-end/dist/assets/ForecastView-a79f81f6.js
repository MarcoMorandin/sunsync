import{i as H,j as U,l as J,s as K}from"./mdi-9b0bf6d7.js";import{c as Q,_ as X}from"./chart.config-51d096d4.js";import{c as Y,b as Z}from"./SectionTitleLineWithButton-c1385c23.js";import{_ as z}from"./darkMode-8dbeebf5.js";import{_ as ee}from"./LayoutAuthenticated-269f4650.js";import{e as F,g as u,h as G,j as I,B as N,l as b,q as C,o as s,c as f,i as $,w as l,d as h,t as i,s as V,a,b as e,u as m,F as M,v as x,x as te,k as ae}from"./index-c317085a.js";import{_ as le}from"./CardBoxModal-22555bff.js";import{_ as oe}from"./BaseLevel-24129793.js";import{_ as B}from"./BaseButtons-b53453a8.js";import{_ as T}from"./BaseButton-2fca0dd5.js";import{S as W}from"./svg-icon-bce0f443.js";import{_ as ne}from"./NotificationBar-d16931a1.js";const re=e("b",null,"ERRORE: ",-1),se=e("th",null,"Data",-1),ie=e("th",null,"Produzione Prevista",-1),ue={"data-label":"date"},ce={"data-label":"description"},de=e("td",null,null,-1),pe={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},_e={__name:"TableForecast",props:{pvInfo:{type:Object,required:!0}},setup(E){const g=E,_=F(),v=u(!1),c=u(""),t=u({}),d=u(10),p=u(0),w=u([]);G(async()=>{I.get("http://localhost:3000"+N,{headers:{Authorization:`Bearer ${_.getToken.value}`},params:{pvinfo_id:g.pvInfo._id}}).then(r=>{w.value=r.data}).catch(r=>{r.response.status!=404&&(v.value=!0,r.value="Errore nel caricamento delle previsioni")}),t.value=g.pvInfo});const k=u(!1),j=b(()=>p.value+1),A=b(()=>w.value.slice(d.value*p.value,d.value*(p.value+1))),P=b(()=>Math.ceil(w.value.length!=0?w.value.length/d.value:1)),L=b(()=>{const r=[];for(let n=0;n<P.value;n++)r.push(n);return r}),y=u({});async function O(r){await I.get("http://localhost:3000"+te+"/"+t.value.ws_id,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(n=>{y.value=n.data}).catch(n=>{v.value=!0,n.value="Errore nel caricamento della stazione meteo"}),k.value=!0}return(r,n)=>{const S=C("GMapInfoWindow"),D=C("GMapMarker"),R=C("GMapMap");return s(),f(M,null,[v.value?(s(),$(ne,{key:0,color:"danger",icon:r.mdiMonitorCellphone},{default:l(()=>[re,h(" "+i(c.value),1)]),_:1},8,["icon"])):V("",!0),a(le,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=o=>k.value=o),title:"Dettagli"},{default:l(()=>[e("p",null,[h(" Nome: "),e("strong",null,i(t.value.description),1)]),e("p",null,[h(" Status: "),e("strong",null,i(t.value.status),1)]),e("p",null,[h(" Potenza Installata: "),e("strong",null,i((t.value.installed_power/1e3).toFixed(2))+" kW",1)]),e("p",null,[h(" Stazione meteo: "),e("strong",null,i(y.value.description),1)]),k.value?(s(),$(R,{key:0,center:{lat:t.value.location.lat,lng:t.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[a(D,{position:{lat:t.value.location.lat,lng:t.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[a(S,null,{default:l(()=>[a(m(W),{type:"mdi",path:m(H)},null,8,["path"])]),_:1})]),_:1},8,["position"]),a(D,{position:{lat:y.value.location.lat,lng:y.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[a(S,null,{default:l(()=>[a(m(W),{type:"mdi",path:m(U)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):V("",!0)]),_:1},8,["modelValue"]),e("table",null,[e("thead",null,[e("tr",null,[se,ie,e("th",null,[a(B,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[a(T,{color:"info",icon:m(J),small:"",onClick:n[1]||(n[1]=o=>O(r.index))},null,8,["icon"])]),_:1})])])]),e("tbody",null,[(s(!0),f(M,null,x(A.value,(o,q)=>(s(),f("tr",{key:o._id},[e("td",ue,i(new Date(o.time).toLocaleString("it-IT")),1),e("td",ce,i(o.tomorrow_predicted_power?o.tomorrow_predicted_power.toFixed(3)+" Wh":""),1),de]))),128))])]),e("div",pe,[a(oe,null,{default:l(()=>[a(B,null,{default:l(()=>[(s(!0),f(M,null,x(L.value,o=>(s(),$(T,{key:o,active:o===p.value,label:o+1,color:o===p.value?"lightDark":"whiteDark",small:"",onClick:q=>p.value=o},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+i(j.value)+" di "+i(P.value),1)]),_:1})])],64)}}},Ie={__name:"ForecastView",setup(E){const g=F(),_=u([]),v=async()=>{let c=await I.get("http://localhost:3000"+ae,{headers:{Authorization:`Bearer ${g.getToken.value}`}}).then(t=>t.data);for(let t in c)_.value.push({name:c[t].description+": "+c[t].installed_power/1e3+" kW",pvInfo:c[t],predicted:await Q("info","http://localhost:3000"+N,"","",c[t]._id,"tomorrow_predicted_power","Energy (Wh)")});console.log(_)};return G(async()=>{await v()}),(c,t)=>(s(),$(ee,null,{default:l(()=>[a(Y,null,{default:l(()=>[(s(!0),f(M,null,x(_.value,(d,p)=>(s(),f("div",null,[a(Z,{icon:m(K),title:d.name,main:"",class:"mt-6"},null,8,["icon","title"]),a(z,{class:"mb-6"},{default:l(()=>[a(X,{data:d.predicted,type:"pv",class:"h-72"},null,8,["data"])]),_:2},1024),a(z,{"has-table":""},{default:l(()=>[a(_e,{pvInfo:d.pvInfo},null,8,["pvInfo"])]),_:2},1024)]))),256))]),_:1})]),_:1}))}};export{Ie as default};
