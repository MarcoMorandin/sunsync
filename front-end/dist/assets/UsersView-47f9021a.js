import{u as R,A as X,n as Y,B as Z}from"./mdi-9b0bf6d7.js";import{b as ee,c as ae}from"./SectionTitleLineWithButton-080a5b51.js";import{_ as O}from"./darkMode-fc965fc0.js";import{_ as le}from"./LayoutAuthenticated-0c80f609.js";import{_ as S}from"./CardBoxModal-a8a1c17d.js";import{_ as te}from"./BaseLevel-b45e7703.js";import{_ as T}from"./BaseButtons-dc8cc76b.js";import{_ as U}from"./BaseButton-4f5af7b8.js";import{e as oe,g as s,h as ne,j as P,N as A,l as b,H as se,o as r,c as g,i as h,w as n,d as f,t as i,s as E,a as o,b as a,u as v,F as M,v as z}from"./index-67a10970.js";import{_ as D}from"./NotificationBar-e312b71e.js";import{_ as L,a as j}from"./FormControl-25dd1248.js";const ie=a("b",null,"ERRORE: ",-1),re={class:"text-xl mb-4"},ue=a("b",null,"Username:",-1),de={class:"text-xl mb-4"},ce=a("b",null,"Email:",-1),me=a("p",null,[f(" Cliccando il pulsante 'Conferma' "),a("strong",null,"eliminerai definitivamente "),f(" la stazione meteo e tutti i dati ad essa collegati ")],-1),_e=a("thead",null,[a("tr",null,[a("th",null,"Username"),a("th",null,"Email"),a("th",null,"Ruolo"),a("th",null,"Disabilitato"),a("th")])],-1),ve={"data-label":"username"},fe={"data-label":"mail"},pe={"data-label":"role"},he={"data-label":"disabled"},we={class:"before:hidden lg:w-1 whitespace-nowrap"},be={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},ge={__name:"TableUser",setup(W){const c=oe(),m=s(!1),y=s(""),N=s(!1),x=s(""),k=s(5),_=s(0),p=s([]);ne(async()=>{P.get("https://sunsync-main-service.onrender.com"+A,{headers:{Authorization:`Bearer ${c.getToken.value}`}}).then(l=>{let t=c.getUserId.value,e=!1,u=0;for(;u<l.data.length&&!e;)l.data[u]._id==t?e=!0:u++;l.data.splice(u,1),p.value=l.data}).catch(()=>{m.value=!0,y.value="Errore nel caricamento degli utenti"})});const w=s({}),$=s(!1),F=b(()=>_.value+1),H=b(()=>p.value.slice(k.value*_.value,k.value*(_.value+1))),B=b(()=>Math.ceil(p.value.length/k.value)),G=b(()=>{const l=[];for(let t=0;t<B.value;t++)l.push(t);return l});async function I(l){w.value=p.value[l],$.value=!0}const V=s(!1),C=s({});async function q(l){C.value=p.value[l],V.value=!0}async function J(){await P.delete("https://sunsync-main-service.onrender.com"+A+"/"+C.value._id,{headers:{Authorization:`Bearer ${c.getToken.value}`}}).then(()=>{window.location.reload()}).catch(l=>{m.value=!0,l.value="Errore nell'eliminazione dell'utente"})}async function K(){d.password!=d.repeat?(m.value=!0,y.value="Le password non coincidono!"):await P.patch("https://sunsync-main-service.onrender.com"+A+"/"+C.value._id,{password:d.password},{headers:{Authorization:`Bearer ${c.getToken.value}`}}).then(()=>{N.value=!0,x.value="Modifica avvenuta con successo"}).catch(l=>{m.value=!0,l.value="Errore nella modifica della password"})}const d=se({password:"",repeat:""});return(l,t)=>(r(),g(M,null,[m.value?(r(),h(D,{key:0,color:"danger",icon:l.mdiMonitorCellphone},{default:n(()=>[ie,f(" "+i(y.value),1)]),_:1},8,["icon"])):E("",!0),N.value?(r(),h(D,{key:1,color:"success",icon:l.mdiMonitorCellphone},{default:n(()=>[f(i(x.value),1)]),_:1},8,["icon"])):E("",!0),o(S,{modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=e=>$.value=e),title:"Modifica",button:"warning","button-label":"Modifica","has-cancel":"",onConfirm:t[3]||(t[3]=e=>K(w.value))},{default:n(()=>[o(O,null,{default:n(()=>[a("p",re,[ue,f(" "+i(w.value.username),1)]),a("p",de,[ce,f(" "+i(w.value.mail),1)]),o(L,{label:"Nuova Password",help:"Perfavore inserisci la nuova password"},{default:n(()=>[o(j,{modelValue:d.password,"onUpdate:modelValue":t[0]||(t[0]=e=>d.password=e),icon:v(R),type:"password",name:"login",autocomplete:"new-password"},null,8,["modelValue","icon"])]),_:1}),o(L,{label:"Ripeti Password",help:"Perfavore re-inserisci la nuova password"},{default:n(()=>[o(j,{modelValue:d.repeat,"onUpdate:modelValue":t[1]||(t[1]=e=>d.repeat=e),icon:v(R),type:"password",name:"password",autocomplete:"repeat-password"},null,8,["modelValue","icon"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(S,{modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=e=>V.value=e),title:"Sei sicuro?","has-cancel":"",button:"danger","button-label":"Conferma",onConfirm:t[5]||(t[5]=e=>J())},{default:n(()=>[me]),_:1},8,["modelValue"]),a("table",null,[_e,a("tbody",null,[(r(!0),g(M,null,z(H.value,(e,u)=>(r(),g("tr",{key:e._id},[a("td",ve,i(e.username),1),a("td",fe,i(e.mail),1),a("td",pe,i(e.role==0?"Admin":"Dipendente"),1),a("td",he,i(e.disabled?"SÃ¬":"No"),1),a("td",we,[o(T,{type:"justify-start lg:justify-end","no-wrap":""},{default:n(()=>[o(U,{color:"warning",icon:v(X),small:"",onClick:Q=>I(u)},null,8,["icon","onClick"]),v(c).getRole.value==0?(r(),h(U,{key:0,color:"danger",icon:v(Y),small:"",onClick:Q=>q(u)},null,8,["icon","onClick"])):E("",!0)]),_:2},1024)])]))),128))])]),a("div",be,[o(te,null,{default:n(()=>[o(T,null,{default:n(()=>[(r(!0),g(M,null,z(G.value,e=>(r(),h(U,{key:e,active:e===_.value,label:e+1,color:e===_.value?"lightDark":"whiteDark",small:"",onClick:u=>_.value=e},null,8,["active","label","color","onClick"]))),128))]),_:1}),a("small",null,"Pagina "+i(F.value)+" di "+i(B.value),1)]),_:1})])],64))}},xe={__name:"UsersView",setup(W){return(c,m)=>(r(),h(le,null,{default:n(()=>[o(ae,null,{default:n(()=>[o(ee,{icon:v(Z),title:"Utenti",main:""},null,8,["icon"]),o(O,{"has-table":""},{default:n(()=>[o(ge)]),_:1})]),_:1})]),_:1}))}};export{xe as default};
