import{i as K,j as te,k as re,l as le,n as ae,e as ie,f as ue,g as se,h as ce}from"./mdi-9b0bf6d7.js";import{b as G,c as de}from"./SectionTitleLineWithButton-c1385c23.js";import{_ as U}from"./CardBoxWidget-d8b22a44.js";import{a as me,_ as Z}from"./darkMode-8dbeebf5.js";import{_ as D}from"./CardBoxModal-22555bff.js";import{_ as oe}from"./BaseLevel-24129793.js";import{_ as I}from"./BaseButtons-b53453a8.js";import{_ as P}from"./BaseButton-2fca0dd5.js";import{e as J,g as o,h as Q,j as M,k as ee,l as C,q as V,o as s,c as w,i as k,w as l,d as b,t as p,s as $,a as t,b as e,u as i,F as T,v as j,n as pe,x as H,y as ve,m as fe,p as he}from"./index-c317085a.js";import{S as q}from"./svg-icon-bce0f443.js";import{_ as X}from"./NotificationBar-d16931a1.js";import{_ as _e}from"./LayoutAuthenticated-269f4650.js";import"./PillTag-a8c5fe6b.js";const ge=e("b",null,"ERRORE: ",-1),be=e("p",null,[b(" Cliccando il pulsante 'Conferma' "),e("strong",null,"eliminerai definitivamente "),b(" l'impianto fotovoltaico e tutti i dati ad esso collegati ")],-1),ke=e("thead",null,[e("tr",null,[e("th",null,"Descrizione"),e("th",null,"Potenza Installata"),e("th",{class:"text-center"},"Status"),e("th")])],-1),ye={"data-label":"description"},Ce={"data-label":"installed_power"},we={class:"flex justify-center items-center"},Me={class:"before:hidden lg:w-1 whitespace-nowrap"},$e={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},ze={__name:"TablePv",setup(Y){const _=J(),g=o(!1),y=o(""),v=o(5),d=o(0),f=o([]);Q(async()=>{M.get("http://localhost:3000"+ee,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(a=>{f.value=a.data,f.value.forEach(n=>{n.statusColor=n.status=="ok"?"text-green-600":"text-red-600",n.status=n.status=="ok"?"Funzionamento regolare":"Manutenzione da effettuare"})}).catch(()=>{g.value=!0,y.value="Errore nel caricamento degli impianti fotovoltaici"})});const u=o({}),c=o(!1),R=C(()=>d.value+1),F=C(()=>f.value.slice(v.value*d.value,v.value*(d.value+1))),x=C(()=>Math.ceil(f.value.length/v.value)),L=C(()=>{const a=[];for(let n=0;n<x.value;n++)a.push(n);return a}),z=o({});async function S(a){u.value=f.value[a],await M.get("http://localhost:3000"+H+"/"+u.value.ws_id,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(n=>{z.value=n.data}).catch(n=>{g.value=!0,n.value="Errore nel caricamento delle stazioni meteo"}),c.value=!0}const E=o(!1),A=o({});async function O(a){A.value=f.value[a],E.value=!0}async function h(){await M.delete("http://localhost:3000"+ee+"/"+A.value._id,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(async()=>{window.location.reload()}).catch(a=>{g.value=!0,a.value="Errore nell'eliminazione dell'impianto fotovoltaico"})}return(a,n)=>{const B=V("GMapInfoWindow"),N=V("GMapMarker"),m=V("GMapMap");return s(),w(T,null,[g.value?(s(),k(X,{key:0,color:"danger",icon:a.mdiMonitorCellphone},{default:l(()=>[ge,b(" "+p(y.value),1)]),_:1},8,["icon"])):$("",!0),t(D,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=r=>c.value=r),title:"Dettagli"},{default:l(()=>[e("p",null,[b(" Nome: "),e("strong",null,p(u.value.description),1)]),e("p",null,[b(" Status: "),e("strong",null,p(u.value.status),1)]),e("p",null,[b(" Potenza Installata: "),e("strong",null,p((u.value.installed_power/1e3).toFixed(2))+" kW",1)]),e("p",null,[b(" Stazione meteo: "),e("strong",null,p(z.value.description),1)]),c.value?(s(),k(m,{key:0,center:{lat:u.value.location.lat,lng:u.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[t(N,{position:{lat:u.value.location.lat,lng:u.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(B,null,{default:l(()=>[t(i(q),{type:"mdi",path:i(K)},null,8,["path"])]),_:1})]),_:1},8,["position"]),t(N,{position:{lat:z.value.location.lat,lng:z.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(B,null,{default:l(()=>[t(i(q),{type:"mdi",path:i(te)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):$("",!0)]),_:1},8,["modelValue"]),t(D,{modelValue:E.value,"onUpdate:modelValue":n[1]||(n[1]=r=>E.value=r),title:"Sei sicuro?",button:"danger","button-label":"Conferma","has-cancel":"",onConfirm:n[2]||(n[2]=r=>h())},{default:l(()=>[be]),_:1},8,["modelValue"]),e("table",null,[ke,e("tbody",null,[(s(!0),w(T,null,j(F.value,(r,W)=>(s(),w("tr",{key:r._id},[e("td",ye,p(r.description),1),e("td",Ce,p((r.installed_power/1e3).toFixed(2))+" kW",1),e("td",we,[t(me,{path:i(re),size:30,h:"h-8",class:pe(r.statusColor)},null,8,["path","class"])]),e("td",Me,[t(I,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[t(P,{color:"info",icon:i(le),small:"",onClick:ne=>S(W)},null,8,["icon","onClick"]),i(_).getRole.value==0?(s(),k(P,{key:0,color:"danger",icon:i(ae),small:"",onClick:ne=>O(W)},null,8,["icon","onClick"])):$("",!0)]),_:2},1024)])]))),128))])]),e("div",$e,[t(oe,null,{default:l(()=>[t(I,null,{default:l(()=>[(s(!0),w(T,null,j(L.value,r=>(s(),k(P,{key:r,active:r===d.value,label:r+1,color:r===d.value?"lightDark":"whiteDark",small:"",onClick:W=>d.value=r},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+p(R.value)+" di "+p(x.value),1)]),_:1})])],64)}}},Ee=e("b",null,"ERRORE: ",-1),Pe=e("p",null,[b(" Cliccando il pulsante 'Conferma' "),e("strong",null,"eliminerai definitivamente "),b(" la stazione meteo e tutti i dati ad essa collegati ")],-1),Ve=e("thead",null,[e("tr",null,[e("th",null,"Descrizione"),e("th")])],-1),Te={"data-label":"description"},xe={class:"before:hidden lg:w-1 whitespace-nowrap"},Se={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},We={__name:"TableWs",setup(Y){const _=J(),g=o(!1),y=o(""),v=o(5),d=o(0),f=o([]);Q(async()=>{M.get("http://localhost:3000"+H,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(h=>{f.value=h.data}).catch(()=>{g.value=!0,y.value="Errore nel caricamento delle stazioni meteo"})});const u=o({}),c=o(!1),R=C(()=>d.value+1),F=C(()=>f.value.slice(v.value*d.value,v.value*(d.value+1))),x=C(()=>Math.ceil(f.value.length/v.value)),L=C(()=>{const h=[];for(let a=0;a<x.value;a++)h.push(a);return h});async function z(h){u.value=f.value[h],c.value=!0}const S=o(!1),E=o({});async function A(h){E.value=f.value[h],S.value=!0}async function O(){await M.delete("http://localhost:3000"+H+"/"+E.value._id,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(()=>{window.location.reload()}).catch(h=>{g.value=!0,h.value="Errore nell'eliminazione della stazione meteo"})}return(h,a)=>{const n=V("GMapInfoWindow"),B=V("GMapMarker"),N=V("GMapMap");return s(),w(T,null,[g.value?(s(),k(X,{key:0,color:"danger",icon:h.mdiMonitorCellphone},{default:l(()=>[Ee,b(" "+p(y.value),1)]),_:1},8,["icon"])):$("",!0),t(D,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=m=>c.value=m),title:"Dettagli"},{default:l(()=>[e("p",null,[b(" Nome: "),e("strong",null,p(u.value.description),1)]),c.value?(s(),k(N,{key:0,center:{lat:u.value.location.lat,lng:u.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[t(B,{position:{lat:u.value.location.lat,lng:u.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(n,null,{default:l(()=>[t(i(q),{type:"mdi",path:i(K)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):$("",!0)]),_:1},8,["modelValue"]),t(D,{modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=m=>S.value=m),title:"Sei sicuro?",button:"danger","button-label":"Conferma","has-cancel":"",onConfirm:a[2]||(a[2]=m=>O())},{default:l(()=>[Pe]),_:1},8,["modelValue"]),e("table",null,[Ve,e("tbody",null,[(s(!0),w(T,null,j(F.value,(m,r)=>(s(),w("tr",{key:m._id},[e("td",Te,p(m.description),1),e("td",xe,[t(I,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[t(P,{color:"info",icon:i(le),small:"",onClick:W=>z(r)},null,8,["icon","onClick"]),i(_).getRole.value==0?(s(),k(P,{key:0,color:"danger",icon:i(ae),small:"",onClick:W=>A(r)},null,8,["icon","onClick"])):$("",!0)]),_:2},1024)])]))),128))])]),e("div",Se,[t(oe,null,{default:l(()=>[t(I,null,{default:l(()=>[(s(!0),w(T,null,j(L.value,m=>(s(),k(P,{key:m,active:m===d.value,label:m+1,color:m===d.value?"lightDark":"whiteDark",small:"",onClick:r=>d.value=m},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+p(R.value)+" di "+p(x.value),1)]),_:1})])],64)}}},Re=e("b",null,"ERRORE: ",-1),Ae={class:"grid grid-cols-1 gap-6 lg:grid-cols-3 mb-6"},Je={__name:"HomeView",setup(Y){const _=o(!1),g=o(""),y=J(),v=o({pvNumber:0,money:0}),d=()=>{M.get("http://localhost:3000"+ve,{headers:{Authorization:`Bearer ${y.getToken.value}`}}).then(c=>{v.value.pvNumber=c.data.number_of_pv_systems}).catch(()=>{_.value=!0,g.value="Errore nel caricamento del numero di impianti registrati"})},f=()=>{M.get("http://localhost:3000"+fe,{headers:{Authorization:`Bearer ${y.getToken.value}`},params:{aggregation:"all"}}).then(c=>{v.value.money=Math.floor(c.data[0].total)}).catch(()=>{_.value=!0,g.value="Errore nel caricamento del valore dei soldi risparmiati"})},u=()=>{M.get("http://localhost:3000"+he,{headers:{Authorization:`Bearer ${y.getToken.value}`},params:{aggregation:"all"}}).then(c=>{v.value.production=Math.floor(c.data[0].total/1e3)}).catch(()=>{_.value=!0,g.value="Errore nel caricamento del valore della quantità di energia prodotta"})};return Q(()=>{d(),f(),u()}),(c,R)=>(s(),k(_e,null,{default:l(()=>[t(de,null,{default:l(()=>[_.value?(s(),k(X,{key:0,color:"danger",icon:c.mdiMonitorCellphone},{default:l(()=>[Re,b(" "+p(g.value),1)]),_:1},8,["icon"])):$("",!0),t(G,{icon:i(ie),title:"Overview",main:""},null,8,["icon"]),e("div",Ae,[t(U,{trend:"","trend-type":"up",color:"text-blue-500",icon:i(ue),number:v.value.pvNumber,label:"Impianti Fotovoltaici"},null,8,["icon","number"]),t(U,{trend:"","trend-type":"up",color:"text-emerald-500",icon:i(se),number:v.value.money,prefix:"€ ",label:"Soldi Risparmiati"},null,8,["icon","number"]),t(U,{trend:"","trend-type":"up",color:"text-orange-300",icon:i(ce),number:v.value.production,suffix:" KW/h",label:"Energia Prodotta"},null,8,["icon","number"])]),t(G,{icon:i(K),title:"Impianti Fotovoltaici",main:""},null,8,["icon"]),t(Z,{"has-table":""},{default:l(()=>[t(ze)]),_:1}),t(G),t(G,{icon:i(te),title:"Stazioni Metereologiche",main:""},null,8,["icon"]),t(Z,{"has-table":""},{default:l(()=>[t(We)]),_:1})]),_:1})]),_:1}))}};export{Je as default};
