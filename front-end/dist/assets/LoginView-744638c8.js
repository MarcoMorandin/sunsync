import{g as w,e as g,H as V,f as k,o as d,i as m,w as o,a as e,n as E,I as $,d as v,s as y,u as c,b as x,j as p,J as C,V as N,K as R}from"./index-c317085a.js";import{t as T,u as A}from"./mdi-9b0bf6d7.js";import{L as B,_ as L}from"./LayoutGuest-00956af3.js";import{_ as P}from"./darkMode-8dbeebf5.js";import{_ as f,a as _}from"./FormControl-e78bb9bb.js";import{_ as h}from"./BaseButton-2fca0dd5.js";import{_ as S}from"./BaseButtons-b53453a8.js";import{_ as I}from"./NotificationBar-d16931a1.js";import"./BaseLevel-24129793.js";const U=x("b",null,"ERRORE: ",-1),F={__name:"LoginView",setup(j){const i=w(!1),s=g(),t=V({login:"",pass:"",remember:!1}),n=k(),b=async()=>{p.post("http://localhost:3000"+C,{mail:t.login,password:t.pass},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(async l=>{s.setToken(l.data.token);let a=N.decode(l.data.token);s.setUserId(a.user_id),s.setExpire(a.exp),s.setRole(a.role),await p.get("http://localhost:3000"+R,{headers:{Authorization:`Bearer ${s.getToken.value}`}}).then(r=>r.data.disabled)?setTimeout(()=>n.push("/changepassword"),500):n.push("/dashboard")}).catch(()=>{i.value=!0})};return(l,a)=>(d(),m(B,null,{default:o(()=>[e(L,{bg:"purplePink"},{default:o(({cardClass:u})=>[e(P,{class:E(u),"is-form":"",onSubmit:$(b,["prevent"])},{footer:o(()=>[e(S,null,{default:o(()=>[e(h,{type:"submit",color:"info",label:"Login"}),e(h,{to:"/",color:"info",outline:"",label:"Indietro"})]),_:1})]),default:o(()=>[i.value?(d(),m(I,{key:0,color:"danger",icon:l.mdiMonitorCellphone},{default:o(()=>[U,v(" Errore nell'effettuare il login ")]),_:1},8,["icon"])):y("",!0),e(f,{label:"Email",help:"Perfavore inserisci la tua email"},{default:o(()=>[e(_,{modelValue:t.login,"onUpdate:modelValue":a[0]||(a[0]=r=>t.login=r),icon:c(T),name:"login",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(f,{label:"Password",help:"Perfavore inserisci la tua password"},{default:o(()=>[e(_,{modelValue:t.pass,"onUpdate:modelValue":a[1]||(a[1]=r=>t.pass=r),icon:c(A),type:"password",name:"password",autocomplete:"current-password"},null,8,["modelValue","icon"])]),_:1})]),_:2},1032,["class","onSubmit"])]),_:1})]),_:1}))}};export{F as default};
