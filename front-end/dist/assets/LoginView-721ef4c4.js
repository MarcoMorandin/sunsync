import{g as w,e as g,H as V,f as k,o as d,i as m,w as o,a as e,n as y,I as E,d as $,s as v,u as c,b as x,j as p,J as C,V as N,K as R}from"./index-c5522a6f.js";import{t as T,u as z}from"./mdi-9b0bf6d7.js";import{L as A,_ as B}from"./LayoutGuest-8f991638.js";import{_ as L}from"./darkMode-cb7aa1d4.js";import{_ as f,a as _}from"./FormControl-bbcd3755.js";import{_ as b}from"./BaseButton-9889cf24.js";import{_ as P}from"./BaseButtons-5d5c878a.js";import{_ as S}from"./NotificationBar-23b56f09.js";import"./BaseLevel-addfce22.js";const I=x("b",null,"ERRORE: ",-1),F={__name:"LoginView",setup(U){const i=w(!1),t=g(),s=V({login:"",pass:"",remember:!1}),l=k(),h=async()=>{p.post("http://sunsync-backend.azurewebsites.net"+C,{mail:s.login,password:s.pass},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(async r=>{t.setToken(r.data.token);let a=N.decode(r.data.token);t.setUserId(a.user_id),t.setExpire(a.exp),t.setRole(a.role),await p.get("http://sunsync-backend.azurewebsites.net"+R,{headers:{Authorization:`Bearer ${t.getToken.value}`}}).then(n=>n.data.disabled)?setTimeout(()=>l.push("/changepassword"),500):l.push("/dashboard")}).catch(()=>{i.value=!0})};return(r,a)=>(d(),m(A,null,{default:o(()=>[e(B,{bg:"purplePink"},{default:o(({cardClass:u})=>[e(L,{class:y(u),"is-form":"",onSubmit:E(h,["prevent"])},{footer:o(()=>[e(P,null,{default:o(()=>[e(b,{type:"submit",color:"info",label:"Login"}),e(b,{to:"/",color:"info",outline:"",label:"Indietro"})]),_:1})]),default:o(()=>[i.value?(d(),m(S,{key:0,color:"danger",icon:r.mdiMonitorCellphone},{default:o(()=>[I,$(" Errore nell'effettuare il login ")]),_:1},8,["icon"])):v("",!0),e(f,{label:"Email",help:"Perfavore inserisci la tua email"},{default:o(()=>[e(_,{modelValue:s.login,"onUpdate:modelValue":a[0]||(a[0]=n=>s.login=n),icon:c(T),name:"login",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(f,{label:"Password",help:"Perfavore inserisci la tua password"},{default:o(()=>[e(_,{modelValue:s.pass,"onUpdate:modelValue":a[1]||(a[1]=n=>s.pass=n),icon:c(z),type:"password",name:"password",autocomplete:"current-password"},null,8,["modelValue","icon"])]),_:1})]),_:2},1032,["class","onSubmit"])]),_:1})]),_:1}))}};export{F as default};
