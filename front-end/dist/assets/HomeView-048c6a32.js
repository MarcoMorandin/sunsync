import{i as K,j as te,k as re,l as ae,n as le,e as ie,f as se,g as ue,h as ce}from"./mdi-9b0bf6d7.js";import{b as G,c as de}from"./SectionTitleLineWithButton-b598e757.js";import{_ as U}from"./CardBoxWidget-847b957d.js";import{a as me,_ as Z}from"./darkMode-d9a8e29e.js";import{_ as D}from"./CardBoxModal-8e580fe9.js";import{_ as ne}from"./BaseLevel-744005ac.js";import{_ as I}from"./BaseButtons-da94e1a5.js";import{_ as P}from"./BaseButton-4bae2fa9.js";import{e as J,g as n,h as Q,j as M,k as ee,l as C,q as V,o as u,c as w,i as b,w as a,d as y,t as v,s as $,a as t,b as e,u as i,F as T,v as j,n as ve,x as H,y as pe,m as fe,p as _e}from"./index-bd6cc2fe.js";import{S as q}from"./svg-icon-63bcf086.js";import{_ as X}from"./NotificationBar-eeedb93f.js";import{_ as he}from"./LayoutAuthenticated-2cfa592e.js";import"./PillTag-3522f61a.js";const ge=e("b",null,"ERRORE: ",-1),ye=e("p",null,[y(" Cliccando il pulsante 'Conferma' "),e("strong",null,"eliminerai definitivamente "),y(" l'impianto fotovoltaico e tutti i dati ad esso collegati ")],-1),be=e("thead",null,[e("tr",null,[e("th",null,"Descrizione"),e("th",null,"Potenza Installata"),e("th",{class:"text-center"},"Status"),e("th")])],-1),ke={"data-label":"description"},Ce={"data-label":"installed_power"},we={class:"flex justify-center items-center"},Me={class:"before:hidden lg:w-1 whitespace-nowrap"},$e={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},ze={__name:"TablePv",setup(Y){const h=J(),g=n(!1),k=n(""),p=n(5),d=n(0),f=n([]);Q(async()=>{M.get("https://sunsync-main-service.onrender.com:3000/"+ee,{headers:{Authorization:`Bearer ${h.getToken.value}`}}).then(l=>{f.value=l.data,f.value.forEach(o=>{o.statusColor=o.status=="ok"?"text-green-600":"text-red-600",o.status=o.status=="ok"?"Funzionamento regolare":"Manutenzione da effettuare"})}).catch(()=>{g.value=!0,k.value="Errore nel caricamento degli impianti fotovoltaici"})});const s=n({}),c=n(!1),R=C(()=>d.value+1),F=C(()=>f.value.slice(p.value*d.value,p.value*(d.value+1))),x=C(()=>Math.ceil(f.value.length/p.value)),L=C(()=>{const l=[];for(let o=0;o<x.value;o++)l.push(o);return l}),z=n({});async function S(l){s.value=f.value[l],await M.get("https://sunsync-main-service.onrender.com:3000/"+H+"/"+s.value.ws_id,{headers:{Authorization:`Bearer ${h.getToken.value}`}}).then(o=>{z.value=o.data}).catch(o=>{g.value=!0,o.value="Errore nel caricamento delle stazioni meteo"}),c.value=!0}const E=n(!1),A=n({});async function O(l){A.value=f.value[l],E.value=!0}async function _(){await M.delete("https://sunsync-main-service.onrender.com:3000/"+ee+"/"+A.value._id,{headers:{Authorization:`Bearer ${h.getToken.value}`}}).then(async()=>{window.location.reload()}).catch(l=>{g.value=!0,l.value="Errore nell'eliminazione dell'impianto fotovoltaico"})}return(l,o)=>{const B=V("GMapInfoWindow"),N=V("GMapMarker"),m=V("GMapMap");return u(),w(T,null,[g.value?(u(),b(X,{key:0,color:"danger",icon:l.mdiMonitorCellphone},{default:a(()=>[ge,y(" "+v(k.value),1)]),_:1},8,["icon"])):$("",!0),t(D,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=r=>c.value=r),title:"Dettagli"},{default:a(()=>[e("p",null,[y(" Nome: "),e("strong",null,v(s.value.description),1)]),e("p",null,[y(" Status: "),e("strong",null,v(s.value.status),1)]),e("p",null,[y(" Potenza Installata: "),e("strong",null,v((s.value.installed_power/1e3).toFixed(2))+" kW",1)]),e("p",null,[y(" Stazione meteo: "),e("strong",null,v(z.value.description),1)]),c.value?(u(),b(m,{key:0,center:{lat:s.value.location.lat,lng:s.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:a(()=>[t(N,{position:{lat:s.value.location.lat,lng:s.value.location.long},clickable:!0,draggable:!1},{default:a(()=>[t(B,null,{default:a(()=>[t(i(q),{type:"mdi",path:i(K)},null,8,["path"])]),_:1})]),_:1},8,["position"]),t(N,{position:{lat:z.value.location.lat,lng:z.value.location.long},clickable:!0,draggable:!1},{default:a(()=>[t(B,null,{default:a(()=>[t(i(q),{type:"mdi",path:i(te)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):$("",!0)]),_:1},8,["modelValue"]),t(D,{modelValue:E.value,"onUpdate:modelValue":o[1]||(o[1]=r=>E.value=r),title:"Sei sicuro?",button:"danger","button-label":"Conferma","has-cancel":"",onConfirm:o[2]||(o[2]=r=>_())},{default:a(()=>[ye]),_:1},8,["modelValue"]),e("table",null,[be,e("tbody",null,[(u(!0),w(T,null,j(F.value,(r,W)=>(u(),w("tr",{key:r._id},[e("td",ke,v(r.description),1),e("td",Ce,v((r.installed_power/1e3).toFixed(2))+" kW",1),e("td",we,[t(me,{path:i(re),size:30,h:"h-8",class:ve(r.statusColor)},null,8,["path","class"])]),e("td",Me,[t(I,{type:"justify-start lg:justify-end","no-wrap":""},{default:a(()=>[t(P,{color:"info",icon:i(ae),small:"",onClick:oe=>S(W)},null,8,["icon","onClick"]),i(h).getRole.value==0?(u(),b(P,{key:0,color:"danger",icon:i(le),small:"",onClick:oe=>O(W)},null,8,["icon","onClick"])):$("",!0)]),_:2},1024)])]))),128))])]),e("div",$e,[t(ne,null,{default:a(()=>[t(I,null,{default:a(()=>[(u(!0),w(T,null,j(L.value,r=>(u(),b(P,{key:r,active:r===d.value,label:r+1,color:r===d.value?"lightDark":"whiteDark",small:"",onClick:W=>d.value=r},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+v(R.value)+" di "+v(x.value),1)]),_:1})])],64)}}},Ee=e("b",null,"ERRORE: ",-1),Pe=e("p",null,[y(" Cliccando il pulsante 'Conferma' "),e("strong",null,"eliminerai definitivamente "),y(" la stazione meteo e tutti i dati ad essa collegati ")],-1),Ve=e("thead",null,[e("tr",null,[e("th",null,"Descrizione"),e("th")])],-1),Te={"data-label":"description"},xe={class:"before:hidden lg:w-1 whitespace-nowrap"},Se={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},We={__name:"TableWs",setup(Y){const h=J(),g=n(!1),k=n(""),p=n(5),d=n(0),f=n([]);Q(async()=>{M.get("https://sunsync-main-service.onrender.com:3000/"+H,{headers:{Authorization:`Bearer ${h.getToken.value}`}}).then(_=>{f.value=_.data}).catch(()=>{g.value=!0,k.value="Errore nel caricamento delle stazioni meteo"})});const s=n({}),c=n(!1),R=C(()=>d.value+1),F=C(()=>f.value.slice(p.value*d.value,p.value*(d.value+1))),x=C(()=>Math.ceil(f.value.length/p.value)),L=C(()=>{const _=[];for(let l=0;l<x.value;l++)_.push(l);return _});async function z(_){s.value=f.value[_],c.value=!0}const S=n(!1),E=n({});async function A(_){E.value=f.value[_],S.value=!0}async function O(){await M.delete("https://sunsync-main-service.onrender.com:3000/"+H+"/"+E.value._id,{headers:{Authorization:`Bearer ${h.getToken.value}`}}).then(()=>{window.location.reload()}).catch(_=>{g.value=!0,_.value="Errore nell'eliminazione della stazione meteo"})}return(_,l)=>{const o=V("GMapInfoWindow"),B=V("GMapMarker"),N=V("GMapMap");return u(),w(T,null,[g.value?(u(),b(X,{key:0,color:"danger",icon:_.mdiMonitorCellphone},{default:a(()=>[Ee,y(" "+v(k.value),1)]),_:1},8,["icon"])):$("",!0),t(D,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=m=>c.value=m),title:"Dettagli"},{default:a(()=>[e("p",null,[y(" Nome: "),e("strong",null,v(s.value.description),1)]),c.value?(u(),b(N,{key:0,center:{lat:s.value.location.lat,lng:s.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:a(()=>[t(B,{position:{lat:s.value.location.lat,lng:s.value.location.long},clickable:!0,draggable:!1},{default:a(()=>[t(o,null,{default:a(()=>[t(i(q),{type:"mdi",path:i(K)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):$("",!0)]),_:1},8,["modelValue"]),t(D,{modelValue:S.value,"onUpdate:modelValue":l[1]||(l[1]=m=>S.value=m),title:"Sei sicuro?",button:"danger","button-label":"Conferma","has-cancel":"",onConfirm:l[2]||(l[2]=m=>O())},{default:a(()=>[Pe]),_:1},8,["modelValue"]),e("table",null,[Ve,e("tbody",null,[(u(!0),w(T,null,j(F.value,(m,r)=>(u(),w("tr",{key:m._id},[e("td",Te,v(m.description),1),e("td",xe,[t(I,{type:"justify-start lg:justify-end","no-wrap":""},{default:a(()=>[t(P,{color:"info",icon:i(ae),small:"",onClick:W=>z(r)},null,8,["icon","onClick"]),i(h).getRole.value==0?(u(),b(P,{key:0,color:"danger",icon:i(le),small:"",onClick:W=>A(r)},null,8,["icon","onClick"])):$("",!0)]),_:2},1024)])]))),128))])]),e("div",Se,[t(ne,null,{default:a(()=>[t(I,null,{default:a(()=>[(u(!0),w(T,null,j(L.value,m=>(u(),b(P,{key:m,active:m===d.value,label:m+1,color:m===d.value?"lightDark":"whiteDark",small:"",onClick:r=>d.value=m},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+v(R.value)+" di "+v(x.value),1)]),_:1})])],64)}}},Re=e("b",null,"ERRORE: ",-1),Ae={class:"grid grid-cols-1 gap-6 lg:grid-cols-3 mb-6"},Je={__name:"HomeView",setup(Y){const h=n(!1),g=n(""),k=J(),p=n({pvNumber:0,money:0}),d=()=>{M.get("https://sunsync-main-service.onrender.com:3000/"+pe,{headers:{Authorization:`Bearer ${k.getToken.value}`}}).then(c=>{p.value.pvNumber=c.data.number_of_pv_systems}).catch(()=>{h.value=!0,g.value="Errore nel caricamento del numero di impianti registrati"})},f=()=>{M.get("https://sunsync-main-service.onrender.com:3000/"+fe,{headers:{Authorization:`Bearer ${k.getToken.value}`},params:{aggregation:"all"}}).then(c=>{p.value.money=Math.floor(c.data[0].total)}).catch(()=>{h.value=!0,g.value="Errore nel caricamento del valore dei soldi risparmiati"})},s=()=>{M.get("https://sunsync-main-service.onrender.com:3000/"+_e,{headers:{Authorization:`Bearer ${k.getToken.value}`},params:{aggregation:"all"}}).then(c=>{p.value.production=Math.floor(c.data[0].total/1e3)}).catch(()=>{h.value=!0,g.value="Errore nel caricamento del valore della quantità di energia prodotta"})};return Q(()=>{d(),f(),s()}),(c,R)=>(u(),b(he,null,{default:a(()=>[t(de,null,{default:a(()=>[h.value?(u(),b(X,{key:0,color:"danger",icon:c.mdiMonitorCellphone},{default:a(()=>[Re,y(" "+v(g.value),1)]),_:1},8,["icon"])):$("",!0),t(G,{icon:i(ie),title:"Overview",main:""},null,8,["icon"]),e("div",Ae,[t(U,{trend:"","trend-type":"up",color:"text-blue-500",icon:i(se),number:p.value.pvNumber,label:"Impianti Fotovoltaici"},null,8,["icon","number"]),t(U,{trend:"","trend-type":"up",color:"text-emerald-500",icon:i(ue),number:p.value.money,prefix:"€ ",label:"Soldi Risparmiati"},null,8,["icon","number"]),t(U,{trend:"","trend-type":"up",color:"text-orange-300",icon:i(ce),number:p.value.production,suffix:" KW/h",label:"Energia Prodotta"},null,8,["icon","number"])]),t(G,{icon:i(K),title:"Impianti Fotovoltaici",main:""},null,8,["icon"]),t(Z,{"has-table":""},{default:a(()=>[t(ze)]),_:1}),t(G),t(G,{icon:i(te),title:"Stazioni Metereologiche",main:""},null,8,["icon"]),t(Z,{"has-table":""},{default:a(()=>[t(We)]),_:1})]),_:1})]),_:1}))}};export{Je as default};
