import{u as B,A as X,n as Y,B as Z}from"./mdi-9b0bf6d7.js";import{b as ee,c as ae}from"./SectionTitleLineWithButton-5c3c5b94.js";import{_ as O}from"./darkMode-cb7aa1d4.js";import{_ as te}from"./LayoutAuthenticated-66326c98.js";import{_ as R}from"./CardBoxModal-1620ce40.js";import{_ as le}from"./BaseLevel-addfce22.js";import{_ as S}from"./BaseButtons-5d5c878a.js";import{_ as U}from"./BaseButton-9889cf24.js";import{e as oe,g as s,h as ne,j as P,N as A,l as b,H as se,o as r,c as g,i as h,w as n,d as v,t as i,s as E,a as o,b as a,u as f,F as M,v as T}from"./index-c5522a6f.js";import{_ as D}from"./NotificationBar-23b56f09.js";import{_ as L,a as j}from"./FormControl-bbcd3755.js";const ie=a("b",null,"ERRORE: ",-1),re={class:"text-xl mb-4"},ue=a("b",null,"Username:",-1),de={class:"text-xl mb-4"},ce=a("b",null,"Email:",-1),me=a("p",null,[v(" Cliccando il pulsante 'Conferma' "),a("strong",null,"eliminerai definitivamente "),v(" la stazione meteo e tutti i dati ad essa collegati ")],-1),_e=a("thead",null,[a("tr",null,[a("th",null,"Username"),a("th",null,"Email"),a("th",null,"Ruolo"),a("th",null,"Disabilitato"),a("th")])],-1),fe={"data-label":"username"},ve={"data-label":"mail"},pe={"data-label":"role"},he={"data-label":"disabled"},we={class:"before:hidden lg:w-1 whitespace-nowrap"},be={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},ge={__name:"TableUser",setup(W){const c=oe(),m=s(!1),k=s(""),N=s(!1),x=s(""),y=s(5),_=s(0),p=s([]);ne(async()=>{P.get("http://sunsync-backend.azurewebsites.net"+A,{headers:{Authorization:`Bearer ${c.getToken.value}`}}).then(t=>{let l=c.getUserId.value,e=!1,u=0;for(;u<t.data.length&&!e;)t.data[u]._id==l?e=!0:u++;t.data.splice(u,1),p.value=t.data}).catch(()=>{m.value=!0,k.value="Errore nel caricamento degli utenti"})});const w=s({}),$=s(!1),F=b(()=>_.value+1),H=b(()=>p.value.slice(y.value*_.value,y.value*(_.value+1))),z=b(()=>Math.ceil(p.value.length/y.value)),G=b(()=>{const t=[];for(let l=0;l<z.value;l++)t.push(l);return t});async function I(t){w.value=p.value[t],$.value=!0}const V=s(!1),C=s({});async function q(t){C.value=p.value[t],V.value=!0}async function J(){await P.delete("http://sunsync-backend.azurewebsites.net"+A+"/"+C.value._id,{headers:{Authorization:`Bearer ${c.getToken.value}`}}).then(()=>{window.location.reload()}).catch(t=>{m.value=!0,t.value="Errore nell'eliminazione dell'utente"})}async function K(){d.password!=d.repeat?(m.value=!0,k.value="Le password non coincidono!"):await P.patch("http://sunsync-backend.azurewebsites.net"+A+"/"+C.value._id,{password:d.password},{headers:{Authorization:`Bearer ${c.getToken.value}`}}).then(()=>{N.value=!0,x.value="Modifica avvenuta con successo"}).catch(t=>{m.value=!0,t.value="Errore nella modifica della password"})}const d=se({password:"",repeat:""});return(t,l)=>(r(),g(M,null,[m.value?(r(),h(D,{key:0,color:"danger",icon:t.mdiMonitorCellphone},{default:n(()=>[ie,v(" "+i(k.value),1)]),_:1},8,["icon"])):E("",!0),N.value?(r(),h(D,{key:1,color:"success",icon:t.mdiMonitorCellphone},{default:n(()=>[v(i(x.value),1)]),_:1},8,["icon"])):E("",!0),o(R,{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value=e),title:"Modifica",button:"warning","button-label":"Modifica","has-cancel":"",onConfirm:l[3]||(l[3]=e=>K(w.value))},{default:n(()=>[o(O,null,{default:n(()=>[a("p",re,[ue,v(" "+i(w.value.username),1)]),a("p",de,[ce,v(" "+i(w.value.mail),1)]),o(L,{label:"Nuova Password",help:"Perfavore inserisci la nuova password"},{default:n(()=>[o(j,{modelValue:d.password,"onUpdate:modelValue":l[0]||(l[0]=e=>d.password=e),icon:f(B),type:"password",name:"login",autocomplete:"new-password"},null,8,["modelValue","icon"])]),_:1}),o(L,{label:"Ripeti Password",help:"Perfavore re-inserisci la nuova password"},{default:n(()=>[o(j,{modelValue:d.repeat,"onUpdate:modelValue":l[1]||(l[1]=e=>d.repeat=e),icon:f(B),type:"password",name:"password",autocomplete:"repeat-password"},null,8,["modelValue","icon"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(R,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=e=>V.value=e),title:"Sei sicuro?","has-cancel":"",button:"danger","button-label":"Conferma",onConfirm:l[5]||(l[5]=e=>J())},{default:n(()=>[me]),_:1},8,["modelValue"]),a("table",null,[_e,a("tbody",null,[(r(!0),g(M,null,T(H.value,(e,u)=>(r(),g("tr",{key:e._id},[a("td",fe,i(e.username),1),a("td",ve,i(e.mail),1),a("td",pe,i(e.role==0?"Admin":"Dipendente"),1),a("td",he,i(e.disabled?"SÃ¬":"No"),1),a("td",we,[o(S,{type:"justify-start lg:justify-end","no-wrap":""},{default:n(()=>[o(U,{color:"warning",icon:f(X),small:"",onClick:Q=>I(u)},null,8,["icon","onClick"]),f(c).getRole.value==0?(r(),h(U,{key:0,color:"danger",icon:f(Y),small:"",onClick:Q=>q(u)},null,8,["icon","onClick"])):E("",!0)]),_:2},1024)])]))),128))])]),a("div",be,[o(le,null,{default:n(()=>[o(S,null,{default:n(()=>[(r(!0),g(M,null,T(G.value,e=>(r(),h(U,{key:e,active:e===_.value,label:e+1,color:e===_.value?"lightDark":"whiteDark",small:"",onClick:u=>_.value=e},null,8,["active","label","color","onClick"]))),128))]),_:1}),a("small",null,"Pagina "+i(F.value)+" di "+i(z.value),1)]),_:1})])],64))}},xe={__name:"UsersView",setup(W){return(c,m)=>(r(),h(te,null,{default:n(()=>[o(ae,null,{default:n(()=>[o(ee,{icon:f(Z),title:"Utenti",main:""},null,8,["icon"]),o(O,{"has-table":""},{default:n(()=>[o(ge)]),_:1})]),_:1})]),_:1}))}};export{xe as default};
