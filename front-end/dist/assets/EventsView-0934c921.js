import{i as H,j as U,l as J,a as K,s as Q}from"./mdi-9b0bf6d7.js";import{b as C,c as X}from"./SectionTitleLineWithButton-c1385c23.js";import{_ as D}from"./darkMode-8dbeebf5.js";import{_ as Y}from"./CardBoxModal-22555bff.js";import{_ as Z}from"./BaseLevel-24129793.js";import{_ as N}from"./BaseButtons-b53453a8.js";import{_ as B}from"./BaseButton-2fca0dd5.js";import{e as ee,g as r,h as te,j as G,E as ae,l as k,q as M,o as u,c as y,i as f,w as l,d as p,t as n,s as $,a as t,b as e,u as c,F as E,v as R,x as le}from"./index-c317085a.js";import{S as T}from"./svg-icon-bce0f443.js";import{_ as W}from"./NotificationBar-d16931a1.js";import{_ as oe}from"./LayoutAuthenticated-269f4650.js";const ne=e("b",null,"ERRORE: ",-1),se=e("thead",null,[e("tr",null,[e("th",null,"Data"),e("th",null,"Descrizione Evento"),e("th",null,"Impianto"),e("th")])],-1),re={"data-label":"date"},ie={"data-label":"description"},ue={"data-label":"pv_description"},ce={class:"before:hidden lg:w-1 whitespace-nowrap"},de={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},A={__name:"TableEvent",props:{type:{type:String,required:!0}},setup(S){const w=S,v=ee(),_=r(!1),P=r(""),b=r(5),d=r(0),m=r([]);te(async()=>{G.get("http://localhost:3000"+ae,{headers:{Authorization:`Bearer ${v.getToken.value}`},params:{type:w.type}}).then(o=>{m.value=o.data}).catch(o=>{o.response.status!=404&&(_.value=!0,o.value="Errore nel caricamento degli eventi")})});const i=r({}),h=r(!1),j=k(()=>d.value+1),F=k(()=>m.value.slice(b.value*d.value,b.value*(d.value+1))),z=k(()=>Math.ceil(m.value.length!=0?m.value.length/b.value:1)),L=k(()=>{const o=[];for(let s=0;s<z.value;s++)o.push(s);return o}),g=r({});async function O(o){i.value=m.value[o].pv_info,await G.get("http://localhost:3000"+le+"/"+i.value.ws_id,{headers:{Authorization:`Bearer ${v.getToken.value}`}}).then(s=>{g.value=s.data}).catch(s=>{_.value=!0,s.value="Errore nel caricamento della stazione meteo"}),h.value=!0}return(o,s)=>{const V=M("GMapInfoWindow"),x=M("GMapMarker"),q=M("GMapMap");return u(),y(E,null,[_.value?(u(),f(W,{key:0,color:"danger",icon:o.mdiMonitorCellphone},{default:l(()=>[ne,p(" "+n(P.value),1)]),_:1},8,["icon"])):$("",!0),t(Y,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=a=>h.value=a),title:"Dettagli"},{default:l(()=>[e("p",null,[p(" Nome: "),e("strong",null,n(i.value.description),1)]),e("p",null,[p(" Status: "),e("strong",null,n(i.value.status),1)]),e("p",null,[p(" Potenza Installata: "),e("strong",null,n((i.value.installed_power/1e3).toFixed(2))+" kW",1)]),e("p",null,[p(" Stazione meteo: "),e("strong",null,n(g.value.description),1)]),h.value?(u(),f(q,{key:0,center:{lat:i.value.location.lat,lng:i.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[t(x,{position:{lat:i.value.location.lat,lng:i.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(V,null,{default:l(()=>[t(c(T),{type:"mdi",path:c(H)},null,8,["path"])]),_:1})]),_:1},8,["position"]),t(x,{position:{lat:g.value.location.lat,lng:g.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(V,null,{default:l(()=>[t(c(T),{type:"mdi",path:c(U)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):$("",!0)]),_:1},8,["modelValue"]),e("table",null,[se,e("tbody",null,[(u(!0),y(E,null,R(F.value,(a,I)=>(u(),y("tr",{key:a._id},[e("td",re,n(new Date(a.time).toLocaleString("it-IT")),1),e("td",ie,n(a.description.charAt(0).toUpperCase()+a.description.slice(1)+(a.description=="peak"?": "+(a.value/1e3).toFixed(2)+" kWh":"")),1),e("td",ue,n(a.pv_info.description),1),e("td",ce,[t(N,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[t(B,{color:"info",icon:c(J),small:"",onClick:_e=>O(I)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])]),e("div",de,[t(Z,null,{default:l(()=>[t(N,null,{default:l(()=>[(u(!0),y(E,null,R(L.value,a=>(u(),f(B,{key:a,active:a===d.value,label:a+1,color:a===d.value?"lightDark":"whiteDark",small:"",onClick:I=>d.value=a},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+n(j.value)+" di "+n(z.value),1)]),_:1})])],64)}}},pe=e("b",null,"ERRORE: ",-1),Ee={__name:"EventsView",setup(S){const w=r(!1),v=r("");return(_,P)=>(u(),f(oe,null,{default:l(()=>[t(X,null,{default:l(()=>[w.value?(u(),f(W,{key:0,color:"danger",icon:_.mdiMonitorCellphone},{default:l(()=>[pe,p(" "+n(v.value),1)]),_:1},8,["icon"])):$("",!0),t(C,{icon:c(K),title:"Manutenzione",main:""},null,8,["icon"]),t(D,{"has-table":""},{default:l(()=>[t(A,{type:"warning"})]),_:1}),t(C),t(C,{icon:c(Q),title:"Previsione",main:""},null,8,["icon"]),t(D,{"has-table":""},{default:l(()=>[t(A,{type:"peak"})]),_:1})]),_:1})]),_:1}))}};export{Ee as default};
