import{k as ce,e as x,p as ee,j as Q,l as ne,n as oe,o as ie,w as H,q as de,r as me,s as ve,f as pe,g as fe,h as he,i as _e}from"./endpoints-a97983b3.js";import{b as I,c as ge}from"./SectionTitleLineWithButton-7f6b899e.js";import{_ as U}from"./CardBoxWidget-7bc2a758.js";import{_ as K}from"./darkMode-d4261cad.js";import{o,c as C,b as e,t as b,r as re,j as $,k as te,v as le,i as w,w as l,a as t,l as M,u,m as be,_ as ye,p as we,e as X,g as r,h as Y,q as S,d as k,F as P,s as L}from"./index-8b5b05ee.js";import{_ as z}from"./BaseButton-34cb38d9.js";import{_ as W}from"./BaseButtons-125c5a61.js";import{_ as ke,a as Ce}from"./LayoutAuthenticated-69cdb4e0.js";import{_ as se}from"./BaseLevel-3be95c65.js";import{_ as Z}from"./NotificationBar-7bfe5da8.js";const $e={class:"flex items-center justify-between mb-3"},Me={class:"text-2xl"},ze={__name:"CardBoxComponentTitle",props:{title:{type:String,required:!0}},setup(h){return(s,c)=>(o(),C("div",$e,[e("h1",Me,b(h.title),1),re(s.$slots,"default")]))}},xe={class:"space-y-3"},j={__name:"CardBoxModal",props:{title:{type:String,required:!0},button:{type:String,default:"info"},buttonLabel:{type:String,default:"Fatto"},hasCancel:Boolean,modelValue:{type:[String,Number,Boolean],default:null}},emits:["update:modelValue","cancel","confirm"],setup(h,{emit:s}){const c=h,_=$({get:()=>c.modelValue,set:a=>s("update:modelValue",a)}),d=a=>{_.value=!1,s(a)},i=()=>d("confirm"),m=()=>d("cancel");return window.addEventListener("keydown",a=>{a.key==="Escape"&&_.value&&m()}),(a,v)=>te((o(),w(ke,{onOverlayClick:m},{default:l(()=>[te(t(K,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-2/5 xl:w-4/12 z-50","is-modal":""},{footer:l(()=>[t(W,null,{default:l(()=>[t(z,{label:h.buttonLabel,color:h.button,onClick:i},null,8,["label","color"]),h.hasCancel?(o(),w(z,{key:0,label:"Annulla",color:h.button,outline:"",onClick:m},null,8,["color"])):M("",!0)]),_:1})]),default:l(()=>[t(ze,{title:h.title},{default:l(()=>[h.hasCancel?(o(),w(z,{key:0,icon:u(ce),color:"whiteDark",small:"","rounded-full":"",onClick:be(m,["prevent"])},null,8,["icon","onClick"])):M("",!0)]),_:1},8,["title"]),e("div",xe,[re(a.$slots,"default")])]),_:3},512),[[le,_.value]])]),_:3},512)),[[le,_.value]])}};const ae={mdi:{size:24,viewbox:"0 0 24 24"},"simple-icons":{size:24,viewbox:"0 0 24 24"},default:{size:0,viewbox:"0 0 0 0"}},Ve={name:"icon",props:{type:String,path:{type:String,required:!0},size:{type:[String,Number],default:24},viewbox:String,flip:{type:String,validator:h=>["horizontal","vertical","both","none"].includes(h)},rotate:{type:Number,default:0}},computed:{styles(){return{"--sx":["both","horizontal"].includes(this.flip)?"-1":"1","--sy":["both","vertical"].includes(this.flip)?"-1":"1","--r":isNaN(this.rotate)?this.rotate:this.rotate+"deg"}},defaults(){return ae[this.type]||ae.default},sizeValue(){return this.size||this.defaults.size},viewboxValue(){return this.viewbox||this.defaults.viewbox}}},Ee=["width","height","viewBox"],Se=["d"];function Pe(h,s,c,_,d,i){return o(),C("svg",{width:i.sizeValue,height:i.sizeValue,viewBox:i.viewboxValue,style:we(i.styles)},[e("path",{d:c.path},null,8,Se)],12,Ee)}const J=ye(Ve,[["render",Pe],["__scopeId","data-v-76aa6b74"]]),Be=e("b",null,"ERRORE: ",-1),Te=e("p",null,[k(" Cliccando il pulsante 'Conferma' "),e("strong",null,"eliminerai definitivamente "),k(" l'impianto fotovoltaico e tutti i dati ad esso collegati ")],-1),Ne=e("thead",null,[e("tr",null,[e("th",null,"Descrizione"),e("th",null,"Potenza Installata"),e("th")])],-1),We={"data-label":"description"},Re={"data-label":"installed_power"},Ae={class:"before:hidden lg:w-1 whitespace-nowrap"},Ge={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},De={__name:"TablePv",setup(h){const s=X(),c=r(!1),_=r(""),d=r(5),i=r(0),m=r([]);Y(async()=>{x.get("https://sunsync-main-service.onrender.com"+ee,{headers:{Authorization:`Bearer ${s.getToken.value}`}}).then(n=>{m.value=n.data}).catch(()=>{c.value=!0,_.value="Errore nel caricamento degli impianti fotovoltaici"})});const a=r({}),v=r(!1),R=$(()=>i.value+1),F=$(()=>m.value.slice(d.value*i.value,d.value*(i.value+1))),B=$(()=>Math.ceil(m.value.length/d.value)),O=$(()=>{const n=[];for(let f=0;f<B.value;f++)n.push(f);return n}),V=r({});async function T(n){a.value=m.value[n],await x.get("https://sunsync-main-service.onrender.com"+H+"/"+a.value.ws_id,{headers:{Authorization:`Bearer ${s.getToken.value}`}}).then(f=>{V.value=f.data}).catch(f=>{c.value=!0,f.value="Errore nel caricamento delle stazioni meteo"}),v.value=!0}const E=r(!1),A=r({});async function q(n){A.value=m.value[n],E.value=!0}async function y(){await x.delete("https://sunsync-main-service.onrender.com"+ee+"/"+A.value._id,{headers:{Authorization:`Bearer ${s.getToken.value}`}}).then(async()=>{window.location.reload()}).catch(n=>{c.value=!0,n.value="Errore nell'eliminazione dell'impianto fotovoltaico"})}return(n,f)=>{const G=S("GMapInfoWindow"),D=S("GMapMarker"),g=S("GMapMap");return o(),C(P,null,[c.value?(o(),w(Z,{key:0,color:"danger",icon:n.mdiMonitorCellphone},{default:l(()=>[Be,k(" "+b(_.value),1)]),_:1},8,["icon"])):M("",!0),t(j,{modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=p=>v.value=p),title:"Dettagli"},{default:l(()=>[e("p",null,[k(" Nome: "),e("strong",null,b(a.value.description),1)]),e("p",null,[k(" Potenza Installata: "),e("strong",null,b((a.value.installed_power/1e3).toFixed(2))+" kW",1)]),e("p",null,[k(" Stazione meteo: "),e("strong",null,b(V.value.description),1)]),v.value?(o(),w(g,{key:0,center:{lat:a.value.location.lat,lng:a.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[t(D,{position:{lat:a.value.location.lat,lng:a.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(G,null,{default:l(()=>[t(u(J),{type:"mdi",path:u(Q)},null,8,["path"])]),_:1})]),_:1},8,["position"]),t(D,{position:{lat:V.value.location.lat,lng:V.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(G,null,{default:l(()=>[t(u(J),{type:"mdi",path:u(ne)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):M("",!0)]),_:1},8,["modelValue"]),t(j,{modelValue:E.value,"onUpdate:modelValue":f[1]||(f[1]=p=>E.value=p),title:"Sei sicuro?",button:"danger","button-label":"Conferma","has-cancel":"",onConfirm:f[2]||(f[2]=p=>y())},{default:l(()=>[Te]),_:1},8,["modelValue"]),e("table",null,[Ne,e("tbody",null,[(o(!0),C(P,null,L(F.value,(p,N)=>(o(),C("tr",{key:p._id},[e("td",We,b(p.description),1),e("td",Re,b((p.installed_power/1e3).toFixed(2))+" kW ",1),e("td",Ae,[t(W,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[t(z,{color:"info",icon:u(oe),small:"",onClick:ue=>T(N)},null,8,["icon","onClick"]),u(s).getRole.value==0?(o(),w(z,{key:0,color:"danger",icon:u(ie),small:"",onClick:ue=>q(N)},null,8,["icon","onClick"])):M("",!0)]),_:2},1024)])]))),128))])]),e("div",Ge,[t(se,null,{default:l(()=>[t(W,null,{default:l(()=>[(o(!0),C(P,null,L(O.value,p=>(o(),w(z,{key:p,active:p===i.value,label:p+1,color:p===i.value?"lightDark":"whiteDark",small:"",onClick:N=>i.value=p},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+b(R.value)+" di "+b(B.value),1)]),_:1})])],64)}}},Ie=e("b",null,"ERRORE: ",-1),Le=e("p",null,[k(" Cliccando il pulsante 'Conferma' "),e("strong",null,"eliminerai definitivamente "),k(" la stazione meteo e tutti i dati ad essa collegati ")],-1),je=e("thead",null,[e("tr",null,[e("th",null,"Descrizione"),e("th")])],-1),Fe={"data-label":"description"},Oe={class:"before:hidden lg:w-1 whitespace-nowrap"},qe={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Ue={__name:"TableWs",setup(h){const s=X(),c=r(!1),_=r(""),d=r(5),i=r(0),m=r([]);Y(async()=>{x.get("https://sunsync-main-service.onrender.com"+H,{headers:{Authorization:`Bearer ${s.getToken.value}`}}).then(y=>{m.value=y.data}).catch(()=>{c.value=!0,_.value="Errore nel caricamento delle stazioni meteo"})});const a=r({}),v=r(!1),R=$(()=>i.value+1),F=$(()=>m.value.slice(d.value*i.value,d.value*(i.value+1))),B=$(()=>Math.ceil(m.value.length/d.value)),O=$(()=>{const y=[];for(let n=0;n<B.value;n++)y.push(n);return y});async function V(y){a.value=m.value[y],v.value=!0}const T=r(!1),E=r({});async function A(y){E.value=m.value[y],T.value=!0}async function q(){await x.delete("https://sunsync-main-service.onrender.com"+H+"/"+E.value._id,{headers:{Authorization:`Bearer ${s.getToken.value}`}}).then(()=>{window.location.reload()}).catch(y=>{c.value=!0,y.value="Errore nell'eliminazione della stazione meteo"})}return(y,n)=>{const f=S("GMapInfoWindow"),G=S("GMapMarker"),D=S("GMapMap");return o(),C(P,null,[c.value?(o(),w(Z,{key:0,color:"danger",icon:y.mdiMonitorCellphone},{default:l(()=>[Ie,k(" "+b(_.value),1)]),_:1},8,["icon"])):M("",!0),t(j,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=g=>v.value=g),title:"Dettagli"},{default:l(()=>[e("p",null,[k(" Nome: "),e("strong",null,b(a.value.description),1)]),v.value?(o(),w(D,{key:0,center:{lat:a.value.location.lat,lng:a.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[t(G,{position:{lat:a.value.location.lat,lng:a.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[t(f,null,{default:l(()=>[t(u(J),{type:"mdi",path:u(Q)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):M("",!0)]),_:1},8,["modelValue"]),t(j,{modelValue:T.value,"onUpdate:modelValue":n[1]||(n[1]=g=>T.value=g),title:"Sei sicuro?",button:"danger","button-label":"Conferma","has-cancel":"",onConfirm:n[2]||(n[2]=g=>q())},{default:l(()=>[Le]),_:1},8,["modelValue"]),e("table",null,[je,e("tbody",null,[(o(!0),C(P,null,L(F.value,(g,p)=>(o(),C("tr",{key:g._id},[e("td",Fe,b(g.description),1),e("td",Oe,[t(W,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[t(z,{color:"info",icon:u(oe),small:"",onClick:N=>V(p)},null,8,["icon","onClick"]),u(s).getRole.value==0?(o(),w(z,{key:0,color:"danger",icon:u(ie),small:"",onClick:N=>A(p)},null,8,["icon","onClick"])):M("",!0)]),_:2},1024)])]))),128))])]),e("div",qe,[t(se,null,{default:l(()=>[t(W,null,{default:l(()=>[(o(!0),C(P,null,L(O.value,g=>(o(),w(z,{key:g,active:g===i.value,label:g+1,color:g===i.value?"lightDark":"whiteDark",small:"",onClick:p=>i.value=g},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+b(R.value)+" di "+b(B.value),1)]),_:1})])],64)}}},He=e("b",null,"ERRORE: ",-1),Ke={class:"grid grid-cols-1 gap-6 lg:grid-cols-3 mb-6"},ot={__name:"HomeView",setup(h){const s=r(!1),c=r(""),_=X(),d=r({pvNumber:0,money:0}),i=()=>{x.get("https://sunsync-main-service.onrender.com"+de,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(v=>{d.value.pvNumber=v.data.number_of_pv_systems}).catch(()=>{s.value=!0,c.value="Errore nel caricamento del numero di impianti registrati"})},m=()=>{x.get("https://sunsync-main-service.onrender.com"+me,{headers:{Authorization:`Bearer ${_.getToken.value}`},params:{aggregation:"all"}}).then(v=>{d.value.money=Math.floor(v.data[0].total)}).catch(()=>{s.value=!0,c.value="Errore nel caricamento del valore dei soldi risparmiati"})},a=()=>{x.get("https://sunsync-main-service.onrender.com"+ve,{headers:{Authorization:`Bearer ${_.getToken.value}`},params:{aggregation:"all"}}).then(v=>{d.value.production=Math.floor(v.data[0].total/1e3)}).catch(()=>{s.value=!0,c.value="Errore nel caricamento del valore della quantità di energia prodotta"})};return Y(()=>{i(),m(),a()}),(v,R)=>(o(),w(Ce,null,{default:l(()=>[t(ge,null,{default:l(()=>[s.value?(o(),w(Z,{key:0,color:"danger",icon:v.mdiMonitorCellphone},{default:l(()=>[He,k(" "+b(c.value),1)]),_:1},8,["icon"])):M("",!0),t(I,{icon:u(pe),title:"Overview",main:""},null,8,["icon"]),e("div",Ke,[t(U,{trend:"","trend-type":"up",color:"text-blue-500",icon:u(fe),number:d.value.pvNumber,label:"Impianti Fotovoltaici"},null,8,["icon","number"]),t(U,{trend:"","trend-type":"up",color:"text-emerald-500",icon:u(he),number:d.value.money,prefix:"€ ",label:"Soldi Risparmiati"},null,8,["icon","number"]),t(U,{trend:"","trend-type":"up",color:"text-orange-300",icon:u(_e),number:d.value.production,suffix:" KW/h",label:"Energia Prodotta"},null,8,["icon","number"])]),t(I,{icon:u(Q),title:"Impianti Fotovoltaici",main:""},null,8,["icon"]),t(K,{"has-table":""},{default:l(()=>[t(De)]),_:1}),t(I),t(I,{icon:u(ne),title:"Stazioni Metereologiche",main:""},null,8,["icon"]),t(K,{"has-table":""},{default:l(()=>[t(Ue)]),_:1})]),_:1})]),_:1}))}};export{ot as default};
