import{i as H,j as U,l as J,s as K}from"./mdi-9b0bf6d7.js";import{c as Q,_ as X}from"./chart.config-c559dd8c.js";import{c as Y,b as Z}from"./SectionTitleLineWithButton-4edab5b8.js";import{_ as D}from"./darkMode-afc6965a.js";import{_ as ee}from"./LayoutAuthenticated-c60b5a0e.js";import{e as F,g as u,h as G,j as I,B as N,l as y,q as C,o as r,c as f,i as $,w as l,d as h,t as i,s as V,a,b as e,u as m,F as M,v as z,x as te,k as ae}from"./index-f9584e7f.js";import{_ as le}from"./CardBoxModal-c0bfda88.js";import{_ as oe}from"./BaseLevel-cdac43fa.js";import{_ as B}from"./BaseButtons-ed0e91f5.js";import{_ as T}from"./BaseButton-289b3de1.js";import{S as W}from"./svg-icon-bed5c5e8.js";import{_ as ne}from"./NotificationBar-daca85dd.js";const se=e("b",null,"ERRORE: ",-1),re=e("th",null,"Data",-1),ie=e("th",null,"Produzione Prevista",-1),ue={"data-label":"date"},ce={"data-label":"description"},de=e("td",null,null,-1),pe={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},_e={__name:"TableForecast",props:{pvInfo:{type:Object,required:!0}},setup(x){const g=x,_=F(),v=u(!1),c=u(""),t=u({}),d=u(10),p=u(0),w=u([]);G(async()=>{I.get("https://sunsync-backend.azurewebsites.net"+N,{headers:{Authorization:`Bearer ${_.getToken.value}`},params:{pvinfo_id:g.pvInfo._id}}).then(s=>{w.value=s.data}).catch(s=>{s.response.status!=404&&(v.value=!0,s.value="Errore nel caricamento delle previsioni")}),t.value=g.pvInfo});const b=u(!1),j=y(()=>p.value+1),A=y(()=>w.value.slice(d.value*p.value,d.value*(p.value+1))),E=y(()=>Math.ceil(w.value.length!=0?w.value.length/d.value:1)),L=y(()=>{const s=[];for(let n=0;n<E.value;n++)s.push(n);return s}),k=u({});async function O(s){await I.get("https://sunsync-backend.azurewebsites.net"+te+"/"+t.value.ws_id,{headers:{Authorization:`Bearer ${_.getToken.value}`}}).then(n=>{k.value=n.data}).catch(n=>{v.value=!0,n.value="Errore nel caricamento della stazione meteo"}),b.value=!0}return(s,n)=>{const P=C("GMapInfoWindow"),S=C("GMapMarker"),R=C("GMapMap");return r(),f(M,null,[v.value?(r(),$(ne,{key:0,color:"danger",icon:s.mdiMonitorCellphone},{default:l(()=>[se,h(" "+i(c.value),1)]),_:1},8,["icon"])):V("",!0),a(le,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=o=>b.value=o),title:"Dettagli"},{default:l(()=>[e("p",null,[h(" Nome: "),e("strong",null,i(t.value.description),1)]),e("p",null,[h(" Status: "),e("strong",null,i(t.value.status),1)]),e("p",null,[h(" Potenza Installata: "),e("strong",null,i((t.value.installed_power/1e3).toFixed(2))+" kW",1)]),e("p",null,[h(" Stazione meteo: "),e("strong",null,i(k.value.description),1)]),b.value?(r(),$(R,{key:0,center:{lat:t.value.location.lat,lng:t.value.location.long},zoom:12,options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},"map-type-id":"terrain",class:"w-full h-96"},{default:l(()=>[a(S,{position:{lat:t.value.location.lat,lng:t.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[a(P,null,{default:l(()=>[a(m(W),{type:"mdi",path:m(H)},null,8,["path"])]),_:1})]),_:1},8,["position"]),a(S,{position:{lat:k.value.location.lat,lng:k.value.location.long},clickable:!0,draggable:!1},{default:l(()=>[a(P,null,{default:l(()=>[a(m(W),{type:"mdi",path:m(U)},null,8,["path"])]),_:1})]),_:1},8,["position"])]),_:1},8,["center"])):V("",!0)]),_:1},8,["modelValue"]),e("table",null,[e("thead",null,[e("tr",null,[re,ie,e("th",null,[a(B,{type:"justify-start lg:justify-end","no-wrap":""},{default:l(()=>[a(T,{color:"info",icon:m(J),small:"",onClick:n[1]||(n[1]=o=>O(s.index))},null,8,["icon"])]),_:1})])])]),e("tbody",null,[(r(!0),f(M,null,z(A.value,(o,q)=>(r(),f("tr",{key:o._id},[e("td",ue,i(new Date(o.time).toLocaleString("it-IT")),1),e("td",ce,i(o.tomorrow_predicted_power?o.tomorrow_predicted_power.toFixed(3)+" Wh":""),1),de]))),128))])]),e("div",pe,[a(oe,null,{default:l(()=>[a(B,null,{default:l(()=>[(r(!0),f(M,null,z(L.value,o=>(r(),$(T,{key:o,active:o===p.value,label:o+1,color:o===p.value?"lightDark":"whiteDark",small:"",onClick:q=>p.value=o},null,8,["active","label","color","onClick"]))),128))]),_:1}),e("small",null,"Pagina "+i(j.value)+" di "+i(E.value),1)]),_:1})])],64)}}},Ie={__name:"ForecastView",setup(x){const g=F(),_=u([]),v=async()=>{let c=await I.get("https://sunsync-backend.azurewebsites.net"+ae,{headers:{Authorization:`Bearer ${g.getToken.value}`}}).then(t=>t.data);for(let t in c)_.value.push({name:c[t].description+": "+c[t].installed_power/1e3+" kW",pvInfo:c[t],predicted:await Q("info","https://sunsync-backend.azurewebsites.net"+N,"","",c[t]._id,"tomorrow_predicted_power","Energy (Wh)")});console.log(_)};return G(async()=>{await v()}),(c,t)=>(r(),$(ee,null,{default:l(()=>[a(Y,null,{default:l(()=>[(r(!0),f(M,null,z(_.value,(d,p)=>(r(),f("div",null,[a(Z,{icon:m(K),title:d.name,main:"",class:"mt-6"},null,8,["icon","title"]),a(D,{class:"mb-6"},{default:l(()=>[a(X,{data:d.predicted,type:"pv",class:"h-72"},null,8,["data"])]),_:2},1024),a(D,{"has-table":""},{default:l(()=>[a(_e,{pvInfo:d.pvInfo},null,8,["pvInfo"])]),_:2},1024)]))),256))]),_:1})]),_:1}))}};export{Ie as default};
