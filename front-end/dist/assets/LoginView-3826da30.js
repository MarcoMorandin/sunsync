import{g as w,e as g,H as V,f as k,o as d,i as m,w as o,a as e,n as v,I as y,d as E,s as $,u as c,b as x,j as p,J as C,V as N,K as R}from"./index-21e0d508.js";import{t as T,u as A}from"./mdi-9b0bf6d7.js";import{L as B,_ as L}from"./LayoutGuest-14137b76.js";import{_ as P}from"./darkMode-ca641ea2.js";import{_ as f,a as _}from"./FormControl-fdd58502.js";import{_ as h}from"./BaseButton-1de43908.js";import{_ as S}from"./BaseButtons-fc384e16.js";import{_ as I}from"./NotificationBar-24729e00.js";import"./BaseLevel-2ae97dcb.js";const U=x("b",null,"ERRORE: ",-1),F={__name:"LoginView",setup(j){const i=w(!1),t=g(),s=V({login:"",pass:"",remember:!1}),l=k(),b=async()=>{p.post("https://sunsync-main-service.onrender.com:3000"+C,{mail:s.login,password:s.pass},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(async n=>{t.setToken(n.data.token);let a=N.decode(n.data.token);t.setUserId(a.user_id),t.setExpire(a.exp),t.setRole(a.role),await p.get("https://sunsync-main-service.onrender.com:3000"+R,{headers:{Authorization:`Bearer ${t.getToken.value}`}}).then(r=>r.data.disabled)?setTimeout(()=>l.push("/changepassword"),500):l.push("/dashboard")}).catch(()=>{i.value=!0})};return(n,a)=>(d(),m(B,null,{default:o(()=>[e(L,{bg:"purplePink"},{default:o(({cardClass:u})=>[e(P,{class:v(u),"is-form":"",onSubmit:y(b,["prevent"])},{footer:o(()=>[e(S,null,{default:o(()=>[e(h,{type:"submit",color:"info",label:"Login"}),e(h,{to:"/",color:"info",outline:"",label:"Indietro"})]),_:1})]),default:o(()=>[i.value?(d(),m(I,{key:0,color:"danger",icon:n.mdiMonitorCellphone},{default:o(()=>[U,E(" Errore nell'effettuare il login ")]),_:1},8,["icon"])):$("",!0),e(f,{label:"Email",help:"Perfavore inserisci la tua email"},{default:o(()=>[e(_,{modelValue:s.login,"onUpdate:modelValue":a[0]||(a[0]=r=>s.login=r),icon:c(T),name:"login",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),e(f,{label:"Password",help:"Perfavore inserisci la tua password"},{default:o(()=>[e(_,{modelValue:s.pass,"onUpdate:modelValue":a[1]||(a[1]=r=>s.pass=r),icon:c(A),type:"password",name:"password",autocomplete:"current-password"},null,8,["modelValue","icon"])]),_:1})]),_:2},1032,["class","onSubmit"])]),_:1})]),_:1}))}};export{F as default};
